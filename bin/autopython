#!/usr/bin/env python3

import sys
import click
from autopython import __version__ as version, Presenter
from pkg_resources import get_distribution


def print_version(ctx, param, value):
    if not value or ctx.resilient_parsing:
        return
    click.echo('Version: ' + str(version))
    ctx.exit()


@click.command()
@click.option('-i/--ipython', is_flag=True, help='Use ipython interpreter.')
@click.option('-l/--logging', is_flag=True, help='Use logging.')
@click.option('--delay', default=40, type=click.INT, help='Typing delay.')
@click.option('--version', is_flag=True, callback=print_version, expose_value=False, is_eager=True)
@click.argument('source', type=click.Path(exists=True, file_okay=True), default=None, required=True)
@click.argument('log_file', type=click.Path(), default=None, required=False)
@click.argument('output', type=click.File('w'), default=None, required=False)
def autopython(i, l, delay, source, log_file, output):
    presenter = Presenter(source, use_ipython=i, logging=l, log_file=log_file, typing_delay=delay, output=output)
    presenter.run()

if __name__ == '__main__':
    autopython()
